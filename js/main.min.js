/*! Movavi v0.0.1 | (c) 2020 Kirill Potekhin | MIT License | http://link-to-your-git-repo.com */
"use strict";function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a,n=!0,l=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return n=e.done,e},e:function(e){l=!0,a=e},f:function(){try{n||null==o.return||o.return()}finally{if(l)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}"NodeList"in window&&!NodeList.prototype.forEach&&(console.info("polyfill for IE11"),NodeList.prototype.forEach=function(e,t){t=t||window;for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),Array.from||(Array.from=(function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},r=Math.pow(2,53)-1,o=function(e){var t=(function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t})(e);return Math.min(Math.max(t,0),r)};return function(e){var r=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var a,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!t(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}for(var l,c=o(r.length),d=t(this)?Object(new this(c)):new Array(c),i=0;i<c;)l=r[i],d[i]=n?void 0===a?n(l,i):n.call(a,l,i):l,i+=1;return d.length=c,d}})());var basketLink=document.querySelector(".basket__link"),modal=document.querySelectorAll(".modal"),modalBasket=document.querySelector(".modal--basket"),modalAlarm=document.querySelector(".modal--alarm"),modalBasketClose=modalBasket.querySelector(".basket-modal__exit"),modalAlarmClose=modalAlarm.querySelector(".alarm-modal__exit"),modalOverlay=document.querySelector(".overlay"),deleteTotalButton=modalBasket.querySelector(".basket-modal__total-delete"),productWrapper=modalBasket.querySelector(".basket-modal__products"),orderButton=document.querySelectorAll(".product-card__order"),basketProducts=localStorage.getItem("basketProduct")?JSON.parse(localStorage.getItem("basketProduct")).filter((function(e){return e})):[{title:"ALCHEMY OF CRYSTALS STICKER PACK",priceOld:99,priceClick:99,id:0,img:"img/product.png"}],renderProduct=function(){productWrapper.querySelectorAll(".basket-modal__product").forEach((function(e){e.remove()}));var e,t=_createForOfIteratorHelper(basketProducts);try{for(t.s();!(e=t.n()).done;){var r=e.value,o=localStorage.getItem("isStock")?r.priceOld:r.priceClick;productWrapper.insertAdjacentHTML("beforeEnd",createProduct(r.title,o,r.id,r.img))}}catch(e){t.e(e)}finally{t.f()}onCalculateTotalPrice()},createProduct=function(e,t,r,o){return'<div class="basket-modal__product">\n    <img class="basket-modal__product-image" src="'.concat(o,'" width="134" height="75" alt="product">\n    <div class="basket-modal__product-description">\n      <p class="basket-modal__product-title">').concat(e,'</p>\n      <div class="basket-modal__description-wrapper">\n        <div class="basket-modal__price">\n          <span class="basket-modal__price-value">').concat(t,'.0</span>\n          <span class="basket-modal__price-currency">руб.</span>\n        </div>\n        <a class="basket-modal__delete" href="#" data-id="').concat(r,'">\n          <span class="basket-modal__delete-item">Delete</span>\n        </a>\n      </div>\n    </div>\n  </div>')},getOrderButtom=function(){return orderButton.forEach((function(e,t){e.addEventListener("click",(function(){var e,r,o,a,n;e=Array.from(document.querySelectorAll(".product-card__title"))[t].textContent,r=Array.from(document.querySelectorAll(".product-card__price--actual .product-card__price-value"))[t].textContent,o=Array.from(document.querySelectorAll(".product-card__price--old .product-card__price-value"))[t].textContent,a=localStorage.getItem("isStock")?o:r,n="http://picsum.photos/300/150?r=".concat(Math.random()),basketProducts.some((function(t){return t.title===e}))?alert("Такой товар уже выбран"):(basketProducts.push({title:e,priceOld:o,priceClick:r,id:basketProducts.length,img:n}),productWrapper.insertAdjacentHTML("beforeEnd",createProduct(e,a,t,n))),onCalculateTotalPrice(),onRecordLocalStorageArray()}))}))},onKeyEscDown=function(e){"Escape"!==e.key&&"Esc"!==e.key||onCloseModal()},onClickOverlayCloseModal=function(e){e.target==modalOverlay&&onCloseModal()},onOpenModal=function(e){return function(t){onCloseModal(),e.style.display="block",modalOverlay.style.display="block",document.addEventListener("keydown",onKeyEscDown),document.addEventListener("click",onClickOverlayCloseModal),e==modalBasket&&(t.preventDefault(),onClickDeleteProduct(),onClickDeleteAllProduct(),console.log(basketProducts))}},onCloseModal=function(){modalAlarm.style.display="none",modalBasket.style.display="none",modalOverlay.style.display="none",document.removeEventListener("keydown",onKeyEscDown),document.removeEventListener("click",onClickOverlayCloseModal)},onClickButtonCloseModal=function(e){e.preventDefault(),onCloseModal()};basketLink.addEventListener("click",onOpenModal(modalBasket)),modalBasketClose.addEventListener("click",onClickButtonCloseModal),modalAlarmClose.addEventListener("click",onClickButtonCloseModal);var onRecordLocalStorageArray=function(){localStorage.removeItem("basketProduct"),localStorage.setItem("basketProduct",JSON.stringify(basketProducts))},onCalculateTotalPrice=function(){for(var e=productWrapper.querySelectorAll(".basket-modal__price-value"),t=Array.from(e),r=[],o=0;o<t.length;o++)r.push(Number(t[o].textContent.replace(/ /g,"")));var a=r.length?r.reduce((function(e,t){return e+t})):0;document.querySelector(".basket-modal__total-value").textContent="".concat(a,".0"),document.querySelector(".basket__price-value").textContent="".concat(a,".0")},onClickDeleteProduct=function(){var e=productWrapper.querySelectorAll(".basket-modal__product");modalBasket.querySelectorAll(".basket-modal__delete").forEach((function(t,r){t.addEventListener("click",(function(o){o.preventDefault(),e[r].remove(),basketProducts=basketProducts.filter((function(e){return e.id.toString()!==t.dataset.id})),onRecordLocalStorageArray(),onCalculateTotalPrice()}))}))},onClickDeleteAllProduct=function(){var e=productWrapper.querySelectorAll(".basket-modal__product");deleteTotalButton.addEventListener("click",(function(t){t.preventDefault(),e.forEach((function(e){e.remove(),onCalculateTotalPrice()})),basketProducts.splice(0,basketProducts.length),onRecordLocalStorageArray()}))},alarmInfo=document.querySelector(".product-card__alarm-info"),timerTime=900,lsKey="timerEnd",savedTime=parseInt(localStorage.getItem(lsKey)),castTimeFormat=function(e){return e<10?"0".concat(e):"".concat(e)},timerStart=function(e){localStorage.setItem(lsKey,e.getTime());var t=setInterval((function(){var r=parseInt((e-new Date)/1e3),o=parseInt((e-new Date)/1e3/60),a=parseInt((e-new Date-1e3*o*60)/1e3);alarmInfo.textContent="Offer valid ".concat(castTimeFormat(o)," : ").concat(castTimeFormat(a)),r<=0&&(clearInterval(t),onOpenModal(modalAlarm)(),discountNo(),localStorage.setItem("isStock","false"),renderProduct())}),100)};window.onload=function(){var e=new Date;savedTime?e.setTime(savedTime):e.setTime(e.getTime()+1e3*timerTime),localStorage.getItem("isStock")?discountNo():timerStart(e),renderProduct(),onCalculateTotalPrice(),getOrderButtom()};var discountNo=function(){var e=document.querySelectorAll(".product-card__price");document.querySelector(".product-card__alarm")&&(document.querySelector(".product-card__alarm").remove(),document.querySelector(".product-card__wrapper-detail").style.justifyContent="flex-end",e.forEach((function(e){e.classList.toggle("product-card__price--actual"),!e.classList.contains("product-card__price--actual")&&e.remove()})))};